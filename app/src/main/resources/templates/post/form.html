<!DOCTYPE html>
<html>
<head>
  <meta charset='UTF-8'>
  <title>글쓰기</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div data-th-replace="header :: header"></div>
<div class="post-box">
  <h1>글쓰기</h1>
  <form data-th-action="@{/post/add}" method='post' enctype='multipart/form-data'
        onsubmit="return validateForm()">
    <div class="form-group">
      <label for="title">제목</label>
      <input type='text' id="title" name='title'>
    </div>
    <div class="form-group">
      <label for="content">내용</label>
      <textarea id="content" name='content'></textarea>
    </div>
    <div class="form-group">
      <label for="hashtag">해시태그</label>
      <input type='text' id="hashtag" name='hashtag'>
    </div>
    <div>

      <div class="file-input-container">
        <input type="file" id="files" name="files" multiple>
        <label class="file-input-label" for="files">+</label>
        <div class="file-preview0"></div>
        <button class="hidden delete-button" type="button" id="clear-preview0">x</button>
      </div>


      <div class="file-input-container">
        <input type="file" id="files1" name="files" multiple>
        <label class="file-input-label" for="files1">+</label>
        <div class="file-preview1"></div>
        <button class="hidden delete-button" type="button" id="clear-preview1">x</button>
      </div>


      <div class="file-input-container">
        <input type="file" id="files2" name="files" multiple>
        <label class="file-input-label" for="files2">+</label>
        <div class="file-preview2"></div>
        <button class="hidden delete-button" type="button" id="clear-preview2">x</button>
      </div>


      <div class="file-input-container">
        <input type="file" id="files3" name="files" multiple>
        <label class="file-input-label" for="files3">+</label>
        <div class="file-preview3"></div>
        <button class="hidden delete-button" type="button" id="clear-preview3">x</button>
      </div>

      <div class="file-input-container">
        <input type="file" id="files4" name="files" multiple>
        <label class="file-input-label" for="files4">+</label>
        <div class="file-preview4"></div>
        <button class="hidden delete-button" type="button" id="clear-preview4">x</button>
      </div>
    </div>


    <script>
      const fileInputIds = ['files', 'files1', 'files2', 'files3', 'files4'];

      function validateForm() {
        let allFilesEmpty = true;

        for (let i = 0; i < fileInputIds.length; i++) {
          const inputId = fileInputIds[i];
          const filesInput = document.getElementById(inputId);
          const files = filesInput.files;

          if (files.length > 0) {
            allFilesEmpty = false;
          }
        }

        if (allFilesEmpty) {
          alert('파일을 1장 이상 추가해주세요.');
          return false;
        }

        return true;
      }

      for (let i = 0; i < fileInputIds.length; i++) {
        const inputId = fileInputIds[i];
        const previewContainer = document.querySelector(`.file-preview${i}`);
        const clearButton = document.querySelector(`#clear-preview${i}`);

        document.getElementById(inputId).addEventListener('change', function (e) {
          previewContainer.innerHTML = '';

          const files = e.target.files;
          for (let j = 0; j < files.length; j++) {
            const file = files[j];
            if (file.type.startsWith('image/')) {
              const reader = new FileReader();

              reader.onload = function (e) {
                const img = document.createElement('img');
                img.className = 'preview-image';
                img.src = e.target.result;
                previewContainer.appendChild(img);

                const fileInputLabel = document.querySelector(`[for="${inputId}"]`);
                fileInputLabel.style.display = 'none';

                clearButton.classList.remove('hidden');
              };

              reader.readAsDataURL(file);
            }
          }
        });

        clearButton.addEventListener('click', function () {
          previewContainer.innerHTML = '';

          const fileInputLabel = document.querySelector(`[for="${inputId}"]`);
          fileInputLabel.style.display = 'block';

          clearButton.classList.add('hidden');

          const fileInput = document.getElementById(inputId);
          fileInput.value = '';
        });
      }
    </script>
    <button class="input-button">등록</button>
  </form>
  <script th:src="@{/js/header.js}"></script>
</body>
</html>
